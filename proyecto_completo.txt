

------------------------------------------
FILE: lib\firebase_options.dart
------------------------------------------
// File generated by FlutterFire CLI.
// ignore_for_file: type=lint
import 'package:firebase_core/firebase_core.dart' show FirebaseOptions;
import 'package:flutter/foundation.dart'
    show defaultTargetPlatform, kIsWeb, TargetPlatform;

/// Default [FirebaseOptions] for use with your Firebase apps.
///
/// Example:
/// ```dart
/// import 'firebase_options.dart';
/// // ...
/// await Firebase.initializeApp(
///   options: DefaultFirebaseOptions.currentPlatform,
/// );
/// ```
class DefaultFirebaseOptions {
  static FirebaseOptions get currentPlatform {
    if (kIsWeb) {
      return web;
    }
    switch (defaultTargetPlatform) {
      case TargetPlatform.android:
        return android;
      case TargetPlatform.iOS:
        return ios;
      case TargetPlatform.macOS:
        return macos;
      case TargetPlatform.windows:
        return windows;
      case TargetPlatform.linux:
        throw UnsupportedError(
          'DefaultFirebaseOptions have not been configured for linux - '
          'you can reconfigure this by running the FlutterFire CLI again.',
        );
      default:
        throw UnsupportedError(
          'DefaultFirebaseOptions are not supported for this platform.',
        );
    }
  }

  static const FirebaseOptions web = FirebaseOptions(
    apiKey: 'AIzaSyAluND9rZoaqIBccA0uihgNdCxVcU2WXbw',
    appId: '1:859986520938:web:6a7d9475943cb84a765313',
    messagingSenderId: '859986520938',
    projectId: 'delta-dai-bim',
    authDomain: 'delta-dai-bim.firebaseapp.com',
    storageBucket: 'delta-dai-bim.firebasestorage.app',
    measurementId: 'G-N8F1C1BKE9',
  );

  static const FirebaseOptions android = FirebaseOptions(
    apiKey: 'AIzaSyCKMb2TTA_Q5sowVkyQa7s1-SkAfzaiuMY',
    appId: '1:859986520938:android:16d091d967a7d629765313',
    messagingSenderId: '859986520938',
    projectId: 'delta-dai-bim',
    storageBucket: 'delta-dai-bim.firebasestorage.app',
  );

  static const FirebaseOptions ios = FirebaseOptions(
    apiKey: 'AIzaSyCSyv0qRh9y5mC2hTCZzjHmpy8ufuugcv8',
    appId: '1:859986520938:ios:b6f2aaad0c188186765313',
    messagingSenderId: '859986520938',
    projectId: 'delta-dai-bim',
    storageBucket: 'delta-dai-bim.firebasestorage.app',
    iosBundleId: 'com.example.deltaDaiBim',
  );

  static const FirebaseOptions macos = FirebaseOptions(
    apiKey: 'AIzaSyCSyv0qRh9y5mC2hTCZzjHmpy8ufuugcv8',
    appId: '1:859986520938:ios:b6f2aaad0c188186765313',
    messagingSenderId: '859986520938',
    projectId: 'delta-dai-bim',
    storageBucket: 'delta-dai-bim.firebasestorage.app',
    iosBundleId: 'com.example.deltaDaiBim',
  );

  static const FirebaseOptions windows = FirebaseOptions(
    apiKey: 'AIzaSyAluND9rZoaqIBccA0uihgNdCxVcU2WXbw',
    appId: '1:859986520938:web:7a5f32c02e13eeb0765313',
    messagingSenderId: '859986520938',
    projectId: 'delta-dai-bim',
    authDomain: 'delta-dai-bim.firebaseapp.com',
    storageBucket: 'delta-dai-bim.firebasestorage.app',
    measurementId: 'G-BG85YBTL71',
  );
}


------------------------------------------
FILE: lib\main.dart
------------------------------------------
import 'package:delta_dai_bim_web/pages/admin/upload_model_page.dart';
import 'package:delta_dai_bim_web/pages/admin_page.dart';
import 'package:delta_dai_bim_web/pages/models_page.dart';
import 'package:delta_dai_bim_web/services/auth_guard.dart';
import 'package:flutter/material.dart';
import 'package:firebase_core/firebase_core.dart';
import 'package:flutter_web_plugins/url_strategy.dart';
import 'firebase_options.dart';

// SERVICIOS

// P√ÅGINAS P√öBLICAS
import 'pages/home_page.dart';
import 'pages/login_page.dart';
import 'pages/projects_page.dart';

// P√ÅGINAS ADMINISTRATIVAS (Dentro de la carpeta admin)

void main() async {
  WidgetsFlutterBinding.ensureInitialized();

  // Quitamos el '#' de la URL
  usePathUrlStrategy();

  await Firebase.initializeApp(options: DefaultFirebaseOptions.currentPlatform);

  runApp(const MyApp());
}

class MyApp extends StatelessWidget {
  const MyApp({super.key});

  @override
  Widget build(BuildContext context) {
    return MaterialApp(
      title: 'Delta Dai BIM',
      debugShowCheckedModeBanner: false,

      theme: ThemeData(
        useMaterial3: true,
        primaryColor: const Color(0xFFAC1C1C),
        visualDensity: VisualDensity.adaptivePlatformDensity,
      ),

      initialRoute: '/',
      routes: {
        '/': (context) => const HomePage(),
        '/login': (context) => const LoginPage(),
        '/models': (context) => ModelsPage(),
        '/admin': (context) => const AuthGuard(child: AdminPage()),
        '/upload-model': (context) => const AuthGuard(child: UploadModelPage()),
        '/projects': (context) => ProjectsPage(),
      },
    );
  }
}


------------------------------------------
FILE: lib\core\app_colors.dart
------------------------------------------
import 'package:flutter/material.dart';

class AppColors {
  // Tu rojo corporativo
  static const Color primaryRed = Color(0xFFAC1C1C);
  // Fondo de secciones claras (como usabas en el c√≥digo anterior)
  static const Color bgLight = Color(0xFFF9F9F9);
  static const Color white = Colors.white;
  static const Color black = Color(0xFF121212);
  static const Color grey = Color(0xFF757575);
  static const Color blueAccent = Colors.blueAccent;
  static const Color greyDark = Color(0xFF424242);
  static const Color lightGrey = Color.fromARGB(255, 114, 24, 24);
  static const Color blackgray = Color.fromARGB(0, 100, 98, 98);
}

class AppStyles {
  // El sombreado (Shadow) que quer√≠as
  static List<BoxShadow> standardShadow = [
    BoxShadow(
      color: Colors.black.withValues(alpha: 200),
      blurRadius: 10,
      offset: const Offset(0, 4),
    ),
  ];

  // Estilo de bot√≥n reutilizable
  static ButtonStyle primaryButtonStyle = ElevatedButton.styleFrom(
    backgroundColor: AppColors.primaryRed,
    foregroundColor: Colors.white,
    elevation: 5, // Sombreado autom√°tico de Flutter
    shadowColor: Colors.black.withValues(alpha: 128),
    padding: const EdgeInsets.symmetric(horizontal: 25, vertical: 15),
    shape: RoundedRectangleBorder(borderRadius: BorderRadius.circular(8)),
  );
}


------------------------------------------
FILE: lib\core\app_constans.dart
------------------------------------------
class AppConstants {
  static const String whatsAppNumber = "50253737566"; // El n√∫mero que us√°bamos
  static const String whatsAppMessage =
      "Hola Delta Dai BIM, me gustar√≠a recibir m√°s informaci√≥n sobre sus modelos de casas.";
}


------------------------------------------
FILE: lib\data\models\house_model.dart
------------------------------------------
class HouseModel {
  final String id;
  final String name;
  final String description;
  final String imageUrl;
  final double price;
  final List<String> images;

  HouseModel({
    required this.id,
    required this.name,
    required this.description,
    required this.imageUrl,
    required this.price,
    required this.images,
  });

  // Este m√©todo es el que le falta a tu c√≥digo actual:
  Map<String, dynamic> toMap() {
    return {
      'name': name,
      'description': description,
      'imageUrl': imageUrl,
      'price': price,
      'images': images,
    };
  }

  factory HouseModel.fromFirestore(Map<String, dynamic> data, String id) {
    return HouseModel(
      id: id,
      name: data['name'] ?? '',
      description: data['description'] ?? '',
      imageUrl: data['imageUrl'] ?? '',
      price: (data['price'] ?? 0).toDouble(),
      images: List<String>.from(data['images'] ?? []),
    );
  }
}


------------------------------------------
FILE: lib\data\models\web_content.dart
------------------------------------------
class WebContent {
  final String aboutUs;
  final String mission;
  final String vision;

  WebContent({
    required this.aboutUs,
    required this.mission,
    required this.vision,
  });

  // Transforma lo que viene de Firebase (Mapa) en este objeto de Flutter
  factory WebContent.fromMap(Map<String, dynamic> data) {
    return WebContent(
      aboutUs: data['aboutUs'] ?? "Cargando informaci√≥n...",
      mission: data['mission'] ?? "Cargando informaci√≥n...",
      vision: data['vision'] ?? "Cargando informaci√≥n...",
    );
  }
}


------------------------------------------
FILE: lib\data\services\auth_guard.dart
------------------------------------------
import 'package:firebase_auth/firebase_auth.dart';
import 'package:flutter/material.dart';

class AuthGuard extends StatelessWidget {
  final Widget child;

  const AuthGuard({super.key, required this.child});

  @override
  Widget build(BuildContext context) {
    return StreamBuilder<User?>(
      stream: FirebaseAuth.instance.authStateChanges(),
      builder: (context, snapshot) {
        if (snapshot.connectionState == ConnectionState.waiting) {
          return const Scaffold(
            body: Center(child: CircularProgressIndicator()),
          );
        }

        // 1. SI HAY USUARIO: Todo bien, pasa adelante.
        if (snapshot.hasData && snapshot.data != null) {
          return child;
        }

        // 2. SI NO HAY USUARIO:
        // En lugar de hacer un Navigator agresivo, mostramos una pantalla
        // de seguridad simple. Esto evita que el Stream "secuestre" la navegaci√≥n.
        return Scaffold(
          body: Center(
            child: Column(
              mainAxisAlignment: MainAxisAlignment.center,
              children: [
                const Icon(Icons.lock_outline, size: 80, color: Colors.grey),
                const SizedBox(height: 20),
                const Text(
                  "Acceso restringido",
                  style: TextStyle(fontSize: 22, fontWeight: FontWeight.bold),
                ),
                const SizedBox(height: 10),
                const Text("Debes iniciar sesi√≥n para ver esta p√°gina."),
                const SizedBox(height: 30),
                ElevatedButton(
                  onPressed: () =>
                      Navigator.pushReplacementNamed(context, '/login'),
                  child: const Text("Ir al Login"),
                ),
                TextButton(
                  onPressed: () => Navigator.pushReplacementNamed(context, '/'),
                  child: const Text("Regresar al Inicio"),
                ),
              ],
            ),
          ),
        );
      },
    );
  }
}


------------------------------------------
FILE: lib\data\services\firebase_service.dart
------------------------------------------
// lib/services/firebase_service.dart
import 'package:cloud_firestore/cloud_firestore.dart';
import 'package:delta_dai_bim_web/widgets/models/project_model.dart';
import 'package:firebase_storage/firebase_storage.dart';
import 'package:firebase_auth/firebase_auth.dart';
import 'package:flutter/foundation.dart';
import '../models/house_model.dart';

class FirebaseService {
  final FirebaseFirestore _db = FirebaseFirestore.instance;
  final FirebaseStorage _storage = FirebaseStorage.instance;
  final FirebaseAuth _auth = FirebaseAuth.instance;

  // --- SECCI√ìN: AUTENTICACI√ìN ---
  Future<UserCredential?> signIn(String email, String password) async {
    try {
      return await _auth.signInWithEmailAndPassword(
        email: email,
        password: password,
      );
    } catch (e) {
      debugPrint("Error de autenticaci√≥n: $e");
      return null;
    }
  }

  // --- SECCI√ìN: STORAGE ---
  Future<String> uploadImage(
    Uint8List fileBytes,
    String fileName,
    String folder,
  ) async {
    try {
      Reference ref = _storage.ref().child('$folder/$fileName');
      UploadTask uploadTask = ref.putData(fileBytes);
      TaskSnapshot snap = await uploadTask;
      return await snap.ref.getDownloadURL();
    } catch (e) {
      debugPrint("Error al subir imagen: $e");
      rethrow;
    }
  }

  // --- SECCI√ìN: CONTENIDO DEL HOME (VITAL PARA QUE NO D√â ERROR) ---
  Stream<DocumentSnapshot> getWebContent() =>
      _db.collection('settings').doc('content').snapshots();

  Future<void> updateContent(String field, String newValue) async {
    await _db.collection('settings').doc('content').update({field: newValue});
  }

  // --- SECCI√ìN: MODELOS DE CASAS (CARRUSEL) ---
  Stream<QuerySnapshot> getModels() => _db.collection('models').snapshots();

  Future<void> addHouseModel(HouseModel house) async {
    try {
      await _db.collection('models').add(house.toMap());
    } catch (e) {
      debugPrint("Error al guardar modelo: $e");
      rethrow;
    }
  }

  // Esta es la pieza clave para que el Admin guarde las fotos nuevas
  Future<void> updateHouseModel(HouseModel house) async {
    try {
      await _db.collection('models').doc(house.id).update(house.toMap());
      debugPrint("‚úÖ Firestore actualizado con √©xito");
    } catch (e) {
      debugPrint("‚ùå Error al actualizar Firestore: $e");
      rethrow;
    }
  }

  Future<void> deleteHouseModel(String id) async {
    await _db.collection('models').doc(id).delete();
  }

  // --- SECCI√ìN: PROYECTOS (HISTORIAS) ---
  Stream<List<ProjectModel>> getProjects() {
    return _db
        .collection('projects')
        .orderBy('date', descending: true)
        .snapshots()
        .map(
          (snap) => snap.docs
              .map((doc) => ProjectModel.fromMap(doc.data(), doc.id))
              .toList(),
        );
  }

  Future<void> addProject(ProjectModel project) async {
    await _db.collection('projects').add(project.toMap());
  }

  Future<void> updateProject(ProjectModel project) async {
    await _db.collection('projects').doc(project.id).update(project.toMap());
  }

  Future<void> deleteProject(String id) async {
    await _db.collection('projects').doc(id).delete();
  }
}


------------------------------------------
FILE: lib\data\services\external\whatsapp_service.dart
------------------------------------------
import 'package:delta_dai_bim_web/core/constants/app_constans.dart';
import 'package:flutter/foundation.dart';
import 'package:url_launcher/url_launcher.dart';

class WhatsAppService {
  // Esta es la funci√≥n que Flutter dice que no encuentra
  Future<void> launchWhatsApp({
    String? modelName,
    bool isGeneral = false,
  }) async {
    const String phoneNumber = AppConstants.whatsAppNumber;
    String message = "";

    if (modelName != null) {
      message =
          "Hola Delta Dai BIM, me interesa informaci√≥n del modelo: *$modelName*";
    } else if (isGeneral) {
      message =
          "Hola Delta Dai BIM, me gustar√≠a solicitar una cotizaci√≥n general.";
    } else {
      message = AppConstants.whatsAppMessage;
    }

    final String url =
        "https://api.whatsapp.com/send?phone=$phoneNumber&text=${Uri.encodeComponent(message)}";

    try {
      final Uri uri = Uri.parse(url);
      await launchUrl(uri, mode: LaunchMode.externalApplication);
    } catch (e) {
      debugPrint("Error al abrir WhatsApp: $e");
      // Fallback para web/m√≥vil si falla el primero
      final String fallbackUrl =
          "https://wa.me/$phoneNumber?text=${Uri.encodeComponent(message)}";
      await launchUrl(Uri.parse(fallbackUrl), mode: LaunchMode.platformDefault);
    }
  }
}


------------------------------------------
FILE: lib\pages\admin_page.dart
------------------------------------------
// ignore_for_file: use_build_context_synchronously, avoid_print
import 'dart:typed_data';
import 'package:flutter/material.dart';
import 'package:firebase_auth/firebase_auth.dart';
import 'package:file_picker/file_picker.dart';

import '../services/firebase_service.dart';
import '../models/house_model.dart';
import '../widgets/models/project_model.dart';
import '../core/app_colors.dart';
import '../widgets/shared/app_logo.dart';
import '../widgets/admin/add_house_form.dart';
import '../widgets/admin/admin_house_list.dart';
import '../widgets/admin/add_project_form.dart';
import '../widgets/admin/admin_project_list.dart';

class AdminPage extends StatefulWidget {
  const AdminPage({super.key});

  @override
  State<AdminPage> createState() => _AdminPageState();
}

class _AdminPageState extends State<AdminPage> {
  final FirebaseService _service = FirebaseService();

  final _houseFormKey = GlobalKey<FormState>();
  final _nameCtrl = TextEditingController();
  final _descCtrl = TextEditingController();
  final _priceCtrl = TextEditingController();

  final _projectFormKey = GlobalKey<FormState>();
  final _pTitleCtrl = TextEditingController();
  final _pLocationCtrl = TextEditingController();
  final _pDescCtrl = TextEditingController();

  // --- VARIABLES CORREGIDAS PARA GALER√çA ---
  List<Uint8List> _selectedFiles = [];
  List<String> _fileNames = [];
  String? _editingId;
  List<String> _existingImages = []; // Para conservar fotos en edici√≥n

  void _setupEditHouse(HouseModel house) {
    setState(() {
      _editingId = house.id;
      _nameCtrl.text = house.name;
      _descCtrl.text = house.description;
      _priceCtrl.text = house.price.toString();
      _existingImages = house.images; // Guardamos las URLs que ya existen
      _selectedFiles = [];
      _fileNames = ["Imagen actual (Toca para cambiar)"];
    });
    print("üõ†Ô∏è Editando: ${house.name}");
  }

  void _setupEditProject(ProjectModel project) {
    setState(() {
      _editingId = project.id;
      _pTitleCtrl.text = project.title;
      _pLocationCtrl.text = project.location;
      _pDescCtrl.text = project.description;
      _selectedFiles = [];
      _fileNames = ["Imagen actual (Toca para cambiar)"];
    });
  }

  Future<void> _handlePickImage() async {
    try {
      FilePickerResult? result = await FilePicker.platform.pickFiles(
        type: FileType.image,
        allowMultiple: true,
        withData: true,
      );

      if (result != null) {
        setState(() {
          // Si hab√≠a un placeholder de "Imagen actual", lo borramos
          if (_fileNames.isNotEmpty &&
              _fileNames[0].contains("Imagen actual")) {
            _fileNames.clear();
            _selectedFiles.clear();
          }
          _selectedFiles.addAll(result.files.map((f) => f.bytes!));
          _fileNames.addAll(result.files.map((f) => f.name));
        });
        print("‚úÖ FOTOS SELECCIONADAS: ${_selectedFiles.length}");
      }
    } catch (e) {
      print("‚ùå ERROR AL SELECCIONAR: $e");
    }
  }

  // --- GUARDADO DE CASAS ACTUALIZADO ---
  void _handleSaveHouse() async {
    if (!_houseFormKey.currentState!.validate()) return;

    // Validaci√≥n: Si es nuevo, debe tener fotos. Si es editado, puede usar las viejas.
    if (_selectedFiles.isEmpty && _editingId == null) {
      _showSnackBar("Por favor, selecciona al menos una imagen");
      return;
    }

    // MOSTRAR LOADING
    showDialog(
      context: context,
      barrierDismissible: false,
      builder: (context) => const Center(
        child: CircularProgressIndicator(color: AppColors.primaryRed),
      ),
    );

    try {
      List<String> imageUrls = [];

      // Caso 1: El usuario seleccion√≥ archivos NUEVOS
      if (_selectedFiles.isNotEmpty &&
          !_fileNames[0].contains("Imagen actual")) {
        print("‚è≥ Subiendo nuevas im√°genes...");
        for (int i = 0; i < _selectedFiles.length; i++) {
          String uniqueName = "${DateTime.now().millisecondsSinceEpoch}_$i.jpg";
          String url = await _service.uploadImage(
            _selectedFiles[i],
            uniqueName,
            'models',
          );
          imageUrls.add(url);
        }
      }
      // Caso 2: Es edici√≥n y NO seleccion√≥ fotos nuevas, usamos las existentes
      else if (_editingId != null) {
        imageUrls = _existingImages;
      }

      final houseData = HouseModel(
        id: _editingId ?? '',
        name: _nameCtrl.text,
        description: _descCtrl.text,
        price: double.tryParse(_priceCtrl.text) ?? 0,
        imageUrl: imageUrls.isNotEmpty ? imageUrls.first : "",
        images: imageUrls,
      );

      if (_editingId != null) {
        await _service.updateHouseModel(
          houseData,
        ); // Ahora el servicio ya tiene este m√©todo
        _showSnackBar("¬°Modelo actualizado!");
      } else {
        await _service.addHouseModel(houseData);
        _showSnackBar("¬°Modelo creado con √©xito!");
      }

      Navigator.pop(context); // Quitar Loading
      _resetFields();
    } catch (e) {
      Navigator.pop(context); // Quitar Loading
      print("‚ùå Error al guardar: $e");
      _showSnackBar("Error al guardar: $e");
    }
  }

  void _handleSaveProject() async {
    if (!_projectFormKey.currentState!.validate()) return;
    if (_selectedFiles.isEmpty && _editingId == null) {
      _showSnackBar("Selecciona una foto");
      return;
    }

    showDialog(
      context: context,
      barrierDismissible: false,
      builder: (context) => const Center(child: CircularProgressIndicator()),
    );

    try {
      String imageUrl = "";
      if (_selectedFiles.isNotEmpty &&
          !_fileNames[0].contains("Imagen actual")) {
        imageUrl = await _service.uploadImage(
          _selectedFiles.first,
          "${DateTime.now().millisecondsSinceEpoch}_proj.jpg",
          'projects',
        );
      } else if (_editingId != null) {
        // L√≥gica para mantener imagen de proyecto si fuera necesario
      }

      final projectData = ProjectModel(
        id: _editingId ?? '',
        title: _pTitleCtrl.text,
        location: _pLocationCtrl.text,
        description: _pDescCtrl.text,
        imageUrl: imageUrl,
        date: DateTime.now(),
      );

      if (_editingId != null) {
        await _service.updateProject(projectData);
      } else {
        await _service.addProject(projectData);
      }

      Navigator.pop(context);
      _showSnackBar("¬°Proyecto guardado!");
      _resetFields();
    } catch (e) {
      Navigator.pop(context);
      _showSnackBar("Error al guardar proyecto: $e");
    }
  }

  void _resetFields() {
    _nameCtrl.clear();
    _descCtrl.clear();
    _priceCtrl.clear();
    _pTitleCtrl.clear();
    _pLocationCtrl.clear();
    _pDescCtrl.clear();
    setState(() {
      _selectedFiles = [];
      _fileNames = [];
      _existingImages = [];
      _editingId = null;
    });
  }

  void _showSnackBar(String text) {
    ScaffoldMessenger.of(context).showSnackBar(SnackBar(content: Text(text)));
  }

  @override
  Widget build(BuildContext context) {
    return DefaultTabController(
      length: 2,
      child: Scaffold(
        appBar: AppBar(
          automaticallyImplyLeading: false,
          toolbarHeight: 110,
          leadingWidth: 200,
          leading: const Center(
            child: Padding(
              padding: EdgeInsets.only(left: 16.0),
              child: AppLogoNavbar(height: 90),
            ),
          ),
          title: const Text(
            "Panel del Administrador",
            style: TextStyle(color: Colors.white, fontWeight: FontWeight.bold),
          ),
          centerTitle: true,
          backgroundColor: AppColors.greyDark,
          actions: [
            IconButton(
              icon: const Icon(Icons.logout, color: Colors.white),
              onPressed: () async {
                await FirebaseAuth.instance.signOut();
                if (!context.mounted) return;
                Navigator.pushNamedAndRemoveUntil(
                  context,
                  '/',
                  (route) => false,
                );
              },
            ),
          ],
          bottom: const TabBar(
            indicatorColor: AppColors.primaryRed,
            labelColor: Colors.white,
            unselectedLabelColor: Colors.grey,
            tabs: [
              Tab(icon: Icon(Icons.house), text: "MODELOS DE CASAS"),
              Tab(
                icon: Icon(Icons.history_edu),
                text: "HISTORIAS DE PROYECTOS",
              ),
            ],
          ),
        ),
        body: TabBarView(
          children: [
            _buildTabLayout(
              form: Form(
                key: _houseFormKey,
                child: AddHouseForm(
                  nameCtrl: _nameCtrl,
                  descCtrl: _descCtrl,
                  priceCtrl: _priceCtrl,
                  selectedFiles: _selectedFiles,
                  fileNames: _fileNames,
                  onPickImage: _handlePickImage,
                  onSave: _handleSaveHouse,
                  editingId: _editingId,
                  onCancel: _resetFields,
                ),
              ),
              list: AdminHouseList(service: _service, onEdit: _setupEditHouse),
            ),
            _buildTabLayout(
              form: Form(
                key: _projectFormKey,
                child: AddProjectForm(
                  titleCtrl: _pTitleCtrl,
                  locationCtrl: _pLocationCtrl,
                  descCtrl: _pDescCtrl,
                  selectedFile: _selectedFiles.isNotEmpty
                      ? _selectedFiles.first
                      : null,
                  fileName: _fileNames.isNotEmpty ? _fileNames.first : null,
                  onPickImage: _handlePickImage,
                  onSave: _handleSaveProject,
                  editingId: _editingId,
                  onCancel: _resetFields,
                ),
              ),
              list: AdminProjectList(
                service: _service,
                onEdit: _setupEditProject,
              ),
            ),
          ],
        ),
      ),
    );
  }

  Widget _buildTabLayout({required Widget form, required Widget list}) {
    return Row(
      children: [
        Container(
          width: 450,
          color: Colors.white,
          padding: const EdgeInsets.all(25),
          child: SingleChildScrollView(child: form),
        ),
        Expanded(
          child: Container(
            color: const Color(0xFFF5F5F5),
            padding: const EdgeInsets.all(20),
            child: list,
          ),
        ),
      ],
    );
  }
}


------------------------------------------
FILE: lib\pages\home_page.dart
------------------------------------------
import 'package:flutter/material.dart';
import '../services/firebase_service.dart';
import '../models/web_content.dart';
import '../widgets/shared/custom_navbar.dart';
import '../widgets/shared/custom_footer.dart';
import '../widgets/home/info_section.dart';
import 'package:cloud_firestore/cloud_firestore.dart';
import '../widgets/home/hero_section.dart';
import '../core/app_colors.dart';

class HomePage extends StatelessWidget {
  const HomePage({super.key});

  @override
  Widget build(BuildContext context) {
    final FirebaseService service = FirebaseService();
    final double screenWidth = MediaQuery.of(context).size.width;

    return Scaffold(
      backgroundColor:
          Colors.black, // Fondo base oscuro para transiciones limpias
      extendBodyBehindAppBar: true, // CLAVE: La imagen ahora sube hasta arriba
      appBar: const CustomNavBar(),

      drawer: screenWidth < 900
          ? Drawer(
              child: Container(
                color: const Color(0xFF121212),
                child: ListView(
                  padding: EdgeInsets.zero,
                  children: [
                    const DrawerHeader(
                      decoration: BoxDecoration(color: AppColors.primaryRed),
                      child: Column(
                        mainAxisAlignment: MainAxisAlignment.center,
                        children: [
                          Text(
                            "DELTA DAI BIM",
                            style: TextStyle(
                              color: Colors.white,
                              fontSize: 22,
                              fontWeight: FontWeight.bold,
                            ),
                          ),
                          SizedBox(height: 10),
                          Text(
                            "Precisi√≥n e Innovaci√≥n",
                            style: TextStyle(
                              color: Colors.white70,
                              fontSize: 14,
                            ),
                          ),
                        ],
                      ),
                    ),
                    _drawerItem(context, "Inicio", "/", Icons.home),
                    _drawerItem(
                      context,
                      "Proyectos",
                      "/ProjectsPage",
                      Icons.business,
                    ),
                    _drawerItem(context, "Modelos", "/models", Icons.home_work),
                  ],
                ),
              ),
            )
          : null,

      body: StreamBuilder<DocumentSnapshot>(
        stream: service.getWebContent(),
        builder: (context, snapshot) {
          if (snapshot.hasError) {
            return Center(child: Text("Error: ${snapshot.error}"));
          }
          if (snapshot.connectionState == ConnectionState.waiting) {
            return const Center(child: CircularProgressIndicator());
          }
          if (!snapshot.hasData || !snapshot.data!.exists) {
            return const Center(child: Text("Cargando contenido..."));
          }

          final data = snapshot.data!.data() as Map<String, dynamic>?;
          if (data == null) return const Center(child: Text("Sin datos"));

          final content = WebContent.fromMap(data);

          return SingleChildScrollView(
            child: Column(
              children: [
                const HeroSection(),
                InfoSection(
                  title: "Qui√©nes Somos",
                  content: content.aboutUs,
                  backgroundColor: Colors.white,
                ),
                InfoSection(
                  title: "Misi√≥n",
                  content: content.mission,
                  backgroundColor: const Color(0xFFFDECEA),
                ),
                InfoSection(
                  title: "Visi√≥n",
                  content: content.vision,
                  backgroundColor: Colors.white,
                ),
                const CustomFooter(),
              ],
            ),
          );
        },
      ),
    );
  }

  Widget _drawerItem(
    BuildContext context,
    String title,
    String route,
    IconData icon,
  ) {
    return ListTile(
      leading: Icon(icon, color: Colors.white70),
      title: Text(title, style: const TextStyle(color: Colors.white)),
      onTap: () {
        Navigator.pop(context);
        Navigator.pushNamed(context, route);
      },
    );
  }
}


------------------------------------------
FILE: lib\pages\login_page.dart
------------------------------------------
// ignore_for_file: use_build_context_synchronously

import 'package:flutter/material.dart';
import '../services/firebase_service.dart';
import '../core/app_colors.dart';

class LoginPage extends StatefulWidget {
  const LoginPage({super.key});

  @override
  State<LoginPage> createState() => _LoginPageState();
}

class _LoginPageState extends State<LoginPage> {
  final _emailCtrl = TextEditingController();
  final _passCtrl = TextEditingController();
  final _service = FirebaseService();
  bool _isLoading = false;

  void _handleLogin() async {
    setState(() => _isLoading = true);
    var user = await _service.signIn(
      _emailCtrl.text.trim(),
      _passCtrl.text.trim(),
    );
    setState(() => _isLoading = false);

    if (user != null) {
      Navigator.pushReplacementNamed(context, '/admin');
    } else {
      ScaffoldMessenger.of(
        context,
      ).showSnackBar(const SnackBar(content: Text("Credenciales incorrectas")));
    }
  }

  @override
  Widget build(BuildContext context) {
    return Scaffold(
      backgroundColor: Colors.white,
      body: Center(
        child: Container(
          width: 400,
          padding: const EdgeInsets.all(40),
          decoration: BoxDecoration(
            color: Colors.white,
            borderRadius: BorderRadius.circular(20),
            boxShadow: [
              BoxShadow(
                color: Colors.black.withValues(alpha: 200),
                blurRadius: 20,
              ),
            ],
          ),
          child: Column(
            mainAxisSize: MainAxisSize.min,
            children: [
              const Text(
                "DELTA DAI BIM",
                style: TextStyle(
                  fontSize: 24,
                  fontWeight: FontWeight.bold,
                  letterSpacing: 2,
                ),
              ),
              const SizedBox(height: 10),
              const Text(
                "Panel de Administraci√≥n",
                style: TextStyle(color: Colors.grey),
              ),
              const SizedBox(height: 40),
              TextField(
                controller: _emailCtrl,
                decoration: const InputDecoration(labelText: "Correo"),
              ),
              const SizedBox(height: 20),
              TextField(
                controller: _passCtrl,
                obscureText: true,
                decoration: const InputDecoration(labelText: "Contrase√±a"),
              ),
              const SizedBox(height: 40),
              if (_isLoading)
                const CircularProgressIndicator()
              else
                SizedBox(
                  width: double.infinity,
                  child: ElevatedButton(
                    style: ElevatedButton.styleFrom(
                      backgroundColor: AppColors.primaryRed,
                      padding: const EdgeInsets.symmetric(vertical: 20),
                    ),
                    onPressed: _handleLogin,
                    child: const Text(
                      "ENTRAR",
                      style: TextStyle(color: Colors.white),
                    ),
                  ),
                ),
            ],
          ),
        ),
      ),
    );
  }
}


------------------------------------------
FILE: lib\pages\models_page.dart
------------------------------------------
import 'package:delta_dai_bim_web/services/external/whatsapp_service.dart';
import 'package:delta_dai_bim_web/widgets/shared/custom_navbar.dart';
import 'package:delta_dai_bim_web/core/app_colors.dart';
import 'package:flutter/material.dart';
import 'package:font_awesome_flutter/font_awesome_flutter.dart';
import 'package:carousel_slider/carousel_slider.dart'; // IMPORTANTE: Agregado
import 'package:cloud_firestore/cloud_firestore.dart';
import '../services/firebase_service.dart';
import '../models/house_model.dart';
import '../widgets/models/house_card.dart';

class ModelsPage extends StatelessWidget {
  ModelsPage({super.key});

  final FirebaseService _service = FirebaseService();
  final WhatsAppService _whatsappService = WhatsAppService();

  @override
  Widget build(BuildContext context) {
    return Scaffold(
      extendBodyBehindAppBar: true,
      appBar: const CustomNavBar(),
      body: Stack(
        children: [
          // FONDO DECORATIVO
          Container(
            decoration: BoxDecoration(
              gradient: LinearGradient(
                begin: Alignment.topLeft,
                end: Alignment.bottomRight,
                colors: [
                  AppColors.primaryRed.withValues(alpha: 0.08),
                  Colors.white,
                  AppColors.greyDark.withValues(alpha: 0.05),
                ],
              ),
            ),
          ),

          Positioned(
            top: -100,
            right: -50,
            child: Container(
              width: 400,
              height: 400,
              decoration: BoxDecoration(
                shape: BoxShape.circle,
                color: AppColors.primaryRed.withValues(alpha: 0.05),
              ),
            ),
          ),

          SafeArea(
            child: Column(
              children: [
                const Padding(
                  padding: EdgeInsets.only(top: 40, bottom: 20),
                  child: Column(
                    children: [
                      Text(
                        "NUESTROS MODELOS",
                        style: TextStyle(
                          fontSize: 32,
                          fontWeight: FontWeight.bold,
                          letterSpacing: 3,
                          color: AppColors.greyDark,
                        ),
                      ),
                      SizedBox(height: 10),
                      Divider(
                        indent: 100,
                        endIndent: 100,
                        color: AppColors.primaryRed,
                        thickness: 3,
                      ),
                    ],
                  ),
                ),

                Expanded(
                  child: StreamBuilder<QuerySnapshot>(
                    stream: _service.getModels(),
                    builder: (context, snapshot) {
                      if (!snapshot.hasData) {
                        return const Center(
                          child: CircularProgressIndicator(
                            color: AppColors.primaryRed,
                          ),
                        );
                      }

                      final docs = snapshot.data!.docs;
                      return GridView.builder(
                        padding: const EdgeInsets.symmetric(
                          horizontal: 50,
                          vertical: 20,
                        ),
                        gridDelegate:
                            const SliverGridDelegateWithMaxCrossAxisExtent(
                              maxCrossAxisExtent: 400,
                              childAspectRatio: 0.72,
                              crossAxisSpacing: 30,
                              mainAxisSpacing: 30,
                            ),
                        itemCount: docs.length,
                        itemBuilder: (context, index) {
                          final house = HouseModel.fromFirestore(
                            docs[index].data() as Map<String, dynamic>,
                            docs[index].id,
                          );
                          return HouseCard(
                            house: house,
                            service: _whatsappService,
                            onMoreInfo: () => _showHouseDetails(context, house),
                          );
                        },
                      );
                    },
                  ),
                ),
              ],
            ),
          ),
        ],
      ),
    );
  }

  void _showHouseDetails(BuildContext context, HouseModel house) {
    showDialog(
      context: context,
      builder: (context) => Dialog(
        shape: RoundedRectangleBorder(borderRadius: BorderRadius.circular(20)),
        clipBehavior: Clip.antiAlias,
        child: SizedBox(
          width: 900,
          child: Row(
            mainAxisSize: MainAxisSize.min,
            children: [
              // --- SECCI√ìN IZQUIERDA: CARRUSEL DE IM√ÅGENES ---
              Expanded(
                flex: 5,
                child: SizedBox(
                  height: 500,
                  // Si la lista de im√°genes est√° vac√≠a, mostramos al menos la portada
                  child: (house.images.isEmpty)
                      ? Image.network(house.imageUrl, fit: BoxFit.cover)
                      : CarouselSlider(
                          options: CarouselOptions(
                            height: 500,
                            viewportFraction: 1.0,
                            enlargeCenterPage: false,
                            autoPlay: house.images.length > 1,
                          ),
                          items: house.images.map((url) {
                            return Image.network(
                              url,
                              fit: BoxFit.cover,
                              width: double.infinity,
                              loadingBuilder:
                                  (context, child, loadingProgress) {
                                    if (loadingProgress == null) return child;
                                    return const Center(
                                      child: CircularProgressIndicator(),
                                    );
                                  },
                            );
                          }).toList(),
                        ),
                ),
              ),

              // --- SECCI√ìN DERECHA: INFORMACI√ìN ---
              Expanded(
                flex: 4,
                child: Padding(
                  padding: const EdgeInsets.all(40.0),
                  child: Column(
                    mainAxisSize: MainAxisSize.min,
                    crossAxisAlignment: CrossAxisAlignment.start,
                    children: [
                      Text(
                        house.name.toUpperCase(),
                        style: const TextStyle(
                          fontSize: 36,
                          fontWeight: FontWeight.w900,
                          color: AppColors.greyDark,
                        ),
                      ),
                      const SizedBox(height: 10),
                      Text(
                        "Desde Q${house.price}",
                        style: const TextStyle(
                          fontSize: 24,
                          color: AppColors.primaryRed,
                          fontWeight: FontWeight.bold,
                        ),
                      ),
                      const SizedBox(height: 25),
                      Text(
                        house.description,
                        style: TextStyle(
                          fontSize: 16,
                          height: 1.6,
                          color: Colors.grey[700],
                        ),
                      ),
                      const SizedBox(height: 40),
                      ElevatedButton.icon(
                        style: ElevatedButton.styleFrom(
                          backgroundColor: Colors.green[600],
                          minimumSize: const Size(double.infinity, 65),
                          elevation: 5,
                          shadowColor: Colors.green.withValues(alpha: 0.4),
                          shape: RoundedRectangleBorder(
                            borderRadius: BorderRadius.circular(15),
                          ),
                        ),
                        onPressed: () => _whatsappService.launchWhatsApp(
                          modelName: house.name,
                        ),
                        icon: const FaIcon(
                          FontAwesomeIcons.whatsapp,
                          color: Colors.white,
                          size: 28,
                        ),
                        label: const Text(
                          "COTIZAR POR WHATSAPP",
                          style: TextStyle(
                            color: Colors.white,
                            fontWeight: FontWeight.bold,
                            fontSize: 18,
                          ),
                        ),
                      ),
                    ],
                  ),
                ),
              ),
            ],
          ),
        ),
      ),
    );
  }
}


------------------------------------------
FILE: lib\pages\projects_page.dart
------------------------------------------
import 'package:delta_dai_bim_web/services/external/whatsapp_service.dart';
import 'package:delta_dai_bim_web/widgets/shared/custom_navbar.dart';
import 'package:flutter/material.dart';
import '../services/firebase_service.dart';
import '../widgets/models/project_model.dart';
import '../core/app_colors.dart';

class ProjectsPage extends StatelessWidget {
  final FirebaseService _service = FirebaseService();
  final WhatsAppService _whatsappService = WhatsAppService();

  ProjectsPage({super.key});

  @override
  Widget build(BuildContext context) {
    return Scaffold(
      extendBodyBehindAppBar: true,

      appBar: const CustomNavBar(),

      body: Stack(
        // 2. STACK: Para poner un fondo y luego el contenido
        children: [
          // FONDO DECORATIVO (Para que el cristal tenga algo que difuminar)
          Container(
            width: double.infinity,
            height: 400,
            decoration: BoxDecoration(
              gradient: LinearGradient(
                colors: [AppColors.greyDark.withAlpha(100), Colors.white],
                begin: Alignment.topCenter,
                end: Alignment.bottomCenter,
              ),
            ),
          ),

          // CONTENIDO PRINCIPAL
          SingleChildScrollView(
            child: Column(
              children: [
                // 3. ESPACIADOR: Como el contenido ahora empieza desde arriba,
                // necesitamos un espacio para que el Navbar no tape la frase.
                const SizedBox(height: 120),

                // --- BLOQUE DE BIENVENIDA ---
                Container(
                  width: double.infinity,
                  padding: const EdgeInsets.symmetric(
                    vertical: 60,
                    horizontal: 20,
                  ),
                  child: Column(
                    children: [
                      const Text(
                        "CONSTRUYENDO SUE√ëOS, HISTORIA A HISTORIA",
                        textAlign: TextAlign.center,
                        style: TextStyle(
                          color: AppColors
                              .black, // Cambiado a oscuro para que se lea sobre el blanco/rojo
                          fontSize: 32,
                          fontWeight: FontWeight.bold,
                          letterSpacing: 2,
                        ),
                      ),
                      const SizedBox(height: 20),
                      Container(
                        width: 100,
                        height: 4,
                        color: AppColors.primaryRed,
                      ),
                      const SizedBox(height: 20),
                      const Text(
                        "Cada obra es un compromiso con la excelencia y la visi√≥n de nuestros clientes.",
                        textAlign: TextAlign.center,
                        style: TextStyle(color: Colors.black, fontSize: 18),
                      ),
                    ],
                  ),
                ),

                // --- LISTADO EN ZIGZAG ---
                StreamBuilder<List<ProjectModel>>(
                  stream: _service.getProjects(),
                  builder: (context, snapshot) {
                    if (snapshot.connectionState == ConnectionState.waiting) {
                      return const Center(
                        child: CircularProgressIndicator(
                          color: AppColors.primaryRed,
                        ),
                      );
                    }
                    final projects = snapshot.data ?? [];
                    return ListView.builder(
                      shrinkWrap: true,
                      physics: const NeverScrollableScrollPhysics(),
                      itemCount: projects.length,
                      itemBuilder: (context, index) {
                        final project = projects[index];
                        bool isEven = index % 2 == 0;
                        return _buildProjectRow(project, isEven);
                      },
                    );
                  },
                ),
                const SizedBox(height: 100),
              ],
            ),
          ),
        ],
      ),
    );
  }

  Widget _buildProjectRow(ProjectModel project, bool imageLeft) {
    Widget imagePart = Expanded(
      child: Container(
        height: 400,
        margin: const EdgeInsets.all(20),
        decoration: BoxDecoration(
          borderRadius: BorderRadius.circular(15),
          image: DecorationImage(
            image: NetworkImage(project.imageUrl),
            fit: BoxFit.cover,
          ),
          boxShadow: [
            BoxShadow(
              color: Colors.blueAccent.withAlpha(kRadialReactionAlpha),
              blurRadius: 10,
              offset: const Offset(0, 5),
            ),
          ],
        ),
      ),
    );

    Widget textPart = Expanded(
      child: Padding(
        padding: const EdgeInsets.all(40.0),
        child: Column(
          crossAxisAlignment: imageLeft
              ? CrossAxisAlignment.start
              : CrossAxisAlignment.end,
          children: [
            Text(
              project.location.toUpperCase(),
              style: const TextStyle(
                color: AppColors.greyDark,
                fontWeight: FontWeight.bold,
                letterSpacing: 1.5,
              ),
            ),
            const SizedBox(height: 10),
            Text(
              project.title,
              textAlign: imageLeft ? TextAlign.left : TextAlign.right,
              style: const TextStyle(
                fontSize: 28,
                fontWeight: FontWeight.bold,
                color: AppColors.greyDark,
              ),
            ),
            const SizedBox(height: 20),
            Text(
              project.description,
              textAlign: imageLeft ? TextAlign.left : TextAlign.right,
              style: const TextStyle(
                fontSize: 16,
                color: Colors.black87,
                height: 1.6,
              ),
            ),

            // 4. EL BOT√ìN DE CONTACTO NO INVASIVO
            const SizedBox(height: 30),
            OutlinedButton.icon(
              onPressed: () {
                _whatsappService.launchWhatsApp(
                  modelName:
                      "Proyecto: ${project.title} en ${project.location}",
                );
              },
              icon: const Icon(Icons.chat_bubble_outline, size: 20),
              label: const Text("ME INTERESA UN DISE√ëO AS√ç"),
              style: OutlinedButton.styleFrom(
                foregroundColor: AppColors.greyDark,
                side: const BorderSide(color: AppColors.primaryRed, width: 2),
                padding: const EdgeInsets.symmetric(
                  horizontal: 25,
                  vertical: 18,
                ),
                shape: RoundedRectangleBorder(
                  borderRadius: BorderRadius.circular(30),
                ),
              ),
            ),
          ],
        ),
      ),
    );

    return Container(
      padding: const EdgeInsets.symmetric(horizontal: 10, vertical: 40),
      child: Row(
        children: imageLeft ? [imagePart, textPart] : [textPart, imagePart],
      ),
    );
  }
}


------------------------------------------
FILE: lib\pages\admin\upload_model_page.dart
------------------------------------------
// ignore_for_file: avoid_print, use_build_context_synchronously

import 'dart:typed_data';
import 'package:flutter/material.dart';
import 'package:file_picker/file_picker.dart';
import 'package:firebase_storage/firebase_storage.dart';
import 'package:cloud_firestore/cloud_firestore.dart';
import '../../models/house_model.dart';
import '../../core/app_colors.dart';

class UploadModelPage extends StatefulWidget {
  const UploadModelPage({super.key});

  @override
  State<UploadModelPage> createState() => _UploadModelPageState();
}

class _UploadModelPageState extends State<UploadModelPage> {
  final _nameController = TextEditingController();
  final _descController = TextEditingController();
  final _priceController = TextEditingController();

  List<Uint8List> _selectedImagesBytes = [];
  List<String> _imageNames = [];
  bool _isUploading = false;

  // --- FUNCI√ìN DE REFUERZO PARA SELECCI√ìN M√öLTIPLE ---
  Future<void> _pickImages() async {
    print("--- Iniciando Prueba de Selecci√≥n ---");
    try {
      final result = await FilePicker.platform.pickFiles(
        // Quitamos filtros de imagen para que el SO no se confunda
        type: FileType.any,
        allowMultiple: true,
        withData: true,
      );

      if (result != null) {
        print("Archivos detectados por el sistema: ${result.files.length}");
        setState(() {
          _selectedImagesBytes = result.files.map((f) => f.bytes!).toList();
          _imageNames = result.files.map((f) => f.name).toList();
        });
      } else {
        print("El di√°logo se cerr√≥ sin seleccionar nada.");
      }
    } catch (e) {
      print("Error detectado en el proceso: $e");
    }
  }

  Future<void> _uploadEverything() async {
    if (_nameController.text.isEmpty || _selectedImagesBytes.isEmpty) {
      ScaffoldMessenger.of(context).showSnackBar(
        const SnackBar(
          content: Text("Por favor llena el nombre y elige fotos"),
        ),
      );
      return;
    }

    setState(() => _isUploading = true);

    try {
      List<String> uploadedUrls = [];

      for (int i = 0; i < _selectedImagesBytes.length; i++) {
        String fileName =
            'models/${DateTime.now().millisecondsSinceEpoch}_$i.jpg';
        Reference ref = FirebaseStorage.instance.ref().child(fileName);

        await ref.putData(_selectedImagesBytes[i]);
        String url = await ref.getDownloadURL();
        uploadedUrls.add(url);
      }

      final newModel = HouseModel(
        id: '',
        name: _nameController.text,
        description: _descController.text,
        price: double.tryParse(_priceController.text) ?? 0.0,
        imageUrl: uploadedUrls.first,
        images: uploadedUrls,
      );

      await FirebaseFirestore.instance
          .collection('models')
          .add(newModel.toMap());

      if (mounted) {
        ScaffoldMessenger.of(context).showSnackBar(
          const SnackBar(content: Text("Modelo guardado correctamente")),
        );
        Navigator.pop(context);
      }
    } catch (e) {
      debugPrint("Error: $e");
      ScaffoldMessenger.of(
        context,
      ).showSnackBar(SnackBar(content: Text("Error al subir: $e")));
    } finally {
      setState(() => _isUploading = false);
    }
  }

  @override
  Widget build(BuildContext context) {
    return Scaffold(
      appBar: AppBar(
        title: const Text(
          "Subir Nuevo Modelo",
          style: TextStyle(color: Colors.white),
        ),
        backgroundColor: AppColors.greyDark,
        iconTheme: const IconThemeData(color: Colors.white),
      ),
      body: SingleChildScrollView(
        padding: const EdgeInsets.all(30),
        child: Center(
          child: Container(
            constraints: const BoxConstraints(maxWidth: 600),
            child: Column(
              crossAxisAlignment: CrossAxisAlignment.start,
              children: [
                _buildTextField("Nombre del Modelo", _nameController),
                const SizedBox(height: 20),
                _buildTextField("Descripci√≥n", _descController, maxLines: 4),
                const SizedBox(height: 20),
                _buildTextField(
                  "Precio (Solo n√∫meros)",
                  _priceController,
                  isNumber: true,
                ),
                const SizedBox(height: 30),

                ElevatedButton.icon(
                  onPressed: _pickImages,
                  icon: const Icon(Icons.add_a_photo),
                  label: const Text(
                    "Seleccionar Fotos (Mant√©n presionado Ctrl o Shift)",
                  ),
                  style: ElevatedButton.styleFrom(
                    backgroundColor: Colors.blueGrey,
                    foregroundColor: Colors.white,
                    padding: const EdgeInsets.symmetric(
                      horizontal: 20,
                      vertical: 15,
                    ),
                  ),
                ),

                const SizedBox(height: 15),
                Text(
                  "Archivos seleccionados: ${_imageNames.length}",
                  style: const TextStyle(fontWeight: FontWeight.bold),
                ),
                const SizedBox(height: 10),

                // Mejoramos la visualizaci√≥n de los archivos seleccionados
                Container(
                  padding: const EdgeInsets.all(10),
                  decoration: BoxDecoration(
                    color: Colors.grey[100],
                    borderRadius: BorderRadius.circular(10),
                    border: Border.all(color: Colors.grey[300]!),
                  ),
                  child: Wrap(
                    spacing: 8,
                    children: _imageNames
                        .map(
                          (name) => Chip(
                            label: Text(
                              name,
                              style: const TextStyle(fontSize: 10),
                            ),
                            onDeleted: () {
                              int index = _imageNames.indexOf(name);
                              setState(() {
                                _imageNames.removeAt(index);
                                _selectedImagesBytes.removeAt(index);
                              });
                            },
                          ),
                        )
                        .toList(),
                  ),
                ),

                const SizedBox(height: 50),

                _isUploading
                    ? const Center(
                        child: CircularProgressIndicator(
                          color: AppColors.primaryRed,
                        ),
                      )
                    : SizedBox(
                        width: double.infinity,
                        height: 60,
                        child: ElevatedButton(
                          onPressed: _uploadEverything,
                          style: ElevatedButton.styleFrom(
                            backgroundColor: AppColors.primaryRed,
                            shape: RoundedRectangleBorder(
                              borderRadius: BorderRadius.circular(12),
                            ),
                          ),
                          child: const Text(
                            "GUARDAR MODELO",
                            style: TextStyle(
                              color: Colors.white,
                              fontSize: 18,
                              fontWeight: FontWeight.bold,
                            ),
                          ),
                        ),
                      ),
              ],
            ),
          ),
        ),
      ),
    );
  }

  Widget _buildTextField(
    String label,
    TextEditingController controller, {
    int maxLines = 1,
    bool isNumber = false,
  }) {
    return TextField(
      controller: controller,
      maxLines: maxLines,
      keyboardType: isNumber
          ? const TextInputType.numberWithOptions(decimal: true)
          : TextInputType.text,
      decoration: InputDecoration(
        labelText: label,
        border: const OutlineInputBorder(),
        focusedBorder: const OutlineInputBorder(
          borderSide: BorderSide(color: AppColors.primaryRed, width: 2),
        ),
      ),
    );
  }
}


------------------------------------------
FILE: lib\ui\admin\add_house_form.dart
------------------------------------------
import 'dart:typed_data';
import 'package:flutter/material.dart';
import '../../core/app_colors.dart';

class AddHouseForm extends StatelessWidget {
  final TextEditingController nameCtrl;
  final TextEditingController descCtrl;
  final TextEditingController priceCtrl;
  final List<Uint8List> selectedFiles;
  final List<String> fileNames;
  final VoidCallback onPickImage;
  final VoidCallback onSave;
  final String? editingId;
  final VoidCallback onCancel;

  const AddHouseForm({
    super.key,
    required this.nameCtrl,
    required this.descCtrl,
    required this.priceCtrl,
    required this.selectedFiles,
    required this.fileNames,
    required this.onPickImage,
    required this.onSave,
    required this.editingId,
    required this.onCancel,
  });

  @override
  Widget build(BuildContext context) {
    final isEditing = editingId != null;

    return Column(
      crossAxisAlignment: CrossAxisAlignment.start,
      children: [
        Text(
          isEditing ? "üìù Editando Modelo" : "üè† A√±adir Nuevo Modelo",
          style: const TextStyle(fontSize: 20, fontWeight: FontWeight.bold),
        ),
        const SizedBox(height: 20),

        _buildField("Nombre del Proyecto", nameCtrl),
        const SizedBox(height: 15),
        _buildField("Descripci√≥n", descCtrl, maxLines: 3),
        const SizedBox(height: 15),
        _buildField("Precio (Q)", priceCtrl, isNumber: true),

        const SizedBox(height: 25),

        // --- SECCI√ìN DE IM√ÅGENES REFORMADA ---
        const Text(
          "GALER√çA DE IM√ÅGENES (6-8 sugeridas):",
          style: TextStyle(
            fontWeight: FontWeight.bold,
            color: AppColors.greyDark,
          ),
        ),
        const SizedBox(height: 10),

        // BOT√ìN CON NOMBRE CLARO
        ElevatedButton.icon(
          onPressed: onPickImage,
          style: ElevatedButton.styleFrom(
            backgroundColor: Colors.blueGrey[700],
            foregroundColor: Colors.white,
            minimumSize: const Size(double.infinity, 50),
          ),
          icon: const Icon(Icons.collections),
          label: const Text("SELECCIONAR IM√ÅGENES"),
        ),

        const SizedBox(height: 10),

        // LISTA DE ARCHIVOS CON CONTADOR
        if (fileNames.isNotEmpty)
          Container(
            width: double.infinity,
            padding: const EdgeInsets.all(12),
            decoration: BoxDecoration(
              color: Colors.green[50],
              borderRadius: BorderRadius.circular(8),
              border: Border.all(color: Colors.green[200]!),
            ),
            child: Column(
              crossAxisAlignment: CrossAxisAlignment.start,
              children: [
                Text(
                  "üì∏ Fotos en lista: ${fileNames.length}",
                  style: const TextStyle(
                    fontWeight: FontWeight.bold,
                    color: Colors.green,
                  ),
                ),
                const Divider(),
                ...fileNames
                    .map(
                      (name) => Padding(
                        padding: const EdgeInsets.only(bottom: 4),
                        child: Text(
                          "‚Ä¢ $name",
                          style: const TextStyle(fontSize: 12),
                        ),
                      ),
                    )
                    .toList(),
              ],
            ),
          )
        else
          const Text(
            "No hay fotos seleccionadas",
            style: TextStyle(color: Colors.grey, fontSize: 12),
          ),

        const SizedBox(height: 30),

        SizedBox(
          width: double.infinity,
          height: 55,
          child: ElevatedButton(
            onPressed: onSave,
            style: ElevatedButton.styleFrom(
              backgroundColor: AppColors.primaryRed,
              shape: RoundedRectangleBorder(
                borderRadius: BorderRadius.circular(8),
              ),
            ),
            child: const Text(
              "GUARDAR TODO EL MODELO",
              style: TextStyle(
                color: Colors.white,
                fontWeight: FontWeight.bold,
              ),
            ),
          ),
        ),
      ],
    );
  }

  Widget _buildField(
    String label,
    TextEditingController ctrl, {
    int maxLines = 1,
    bool isNumber = false,
  }) {
    return TextFormField(
      controller: ctrl,
      maxLines: maxLines,
      keyboardType: isNumber ? TextInputType.number : TextInputType.text,
      decoration: InputDecoration(
        labelText: label,
        border: const OutlineInputBorder(),
      ),
    );
  }
}


------------------------------------------
FILE: lib\ui\admin\add_project_form.dart
------------------------------------------
import 'dart:typed_data';
import 'package:flutter/material.dart';
import '../../core/app_colors.dart';

class AddProjectForm extends StatelessWidget {
  final TextEditingController titleCtrl;
  final TextEditingController locationCtrl;
  final TextEditingController descCtrl;
  final Uint8List? selectedFile;
  final String? fileName;
  final VoidCallback onPickImage;
  final VoidCallback onSave;
  final String? editingId; // <--- Para saber si estamos editando
  final VoidCallback onCancel;

  const AddProjectForm({
    super.key,
    required this.titleCtrl,
    required this.locationCtrl,
    required this.descCtrl,
    required this.selectedFile,
    required this.fileName,
    required this.onPickImage,
    required this.onSave,
    required this.onCancel,
    this.editingId,
  });

  @override
  Widget build(BuildContext context) {
    return Column(
      crossAxisAlignment: CrossAxisAlignment.start,
      children: [
        Row(
          mainAxisAlignment: MainAxisAlignment.spaceBetween,
          children: [
            Text(
              editingId == null ? "Nueva Historia" : "Editando Historia",
              style: const TextStyle(fontSize: 20, fontWeight: FontWeight.bold),
            ),
            if (editingId != null)
              IconButton(icon: const Icon(Icons.close), onPressed: onCancel),
          ],
        ),
        const SizedBox(height: 20),

        // CAMPO T√çTULO
        TextFormField(
          controller: titleCtrl,
          decoration: const InputDecoration(
            labelText: "T√≠tulo del Proyecto",
            border: OutlineInputBorder(),
          ),
          validator: (value) =>
              value!.isEmpty ? "El t√≠tulo es obligatorio" : null,
        ),
        const SizedBox(height: 15),

        // CAMPO UBICACI√ìN
        TextFormField(
          controller: locationCtrl,
          decoration: const InputDecoration(
            labelText: "Ubicaci√≥n (Ej: Mixco, Guatemala)",
            border: OutlineInputBorder(),
          ),
          validator: (value) =>
              value!.isEmpty ? "La ubicaci√≥n es necesaria" : null,
        ),
        const SizedBox(height: 15),

        // CAMPO HISTORIA (MULTIL√çNEA)
        TextFormField(
          controller: descCtrl,
          maxLines: 8,
          decoration: const InputDecoration(
            labelText: "Escribe la historia aqu√≠...",
            alignLabelWithHint: true,
            border: OutlineInputBorder(),
          ),
          validator: (value) =>
              value!.length < 10 ? "La historia es muy corta" : null,
        ),
        const SizedBox(height: 20),

        // SELECTOR DE IMAGEN
        Container(
          decoration: BoxDecoration(
            border: Border.all(color: Colors.grey.shade300),
            borderRadius: BorderRadius.circular(10),
          ),
          child: ListTile(
            leading: const Icon(Icons.camera_alt),
            title: Text(fileName ?? "Subir foto de la obra"),
            subtitle: Text(
              selectedFile != null
                  ? "Imagen seleccionada"
                  : "Formatos: JPG, PNG",
            ),
            onTap: onPickImage,
          ),
        ),

        const SizedBox(height: 30),

        // BOT√ìN DE GUARDAR / ACTUALIZAR
        SizedBox(
          width: double.infinity,
          height: 50,
          child: ElevatedButton(
            onPressed: onSave,
            style: ElevatedButton.styleFrom(
              backgroundColor: editingId == null
                  ? AppColors.primaryRed
                  : Colors.blueGrey,
              shape: RoundedRectangleBorder(
                borderRadius: BorderRadius.circular(10),
              ),
            ),
            child: Text(
              editingId == null ? "PUBLICAR HISTORIA" : "GUARDAR CAMBIOS",
              style: const TextStyle(
                color: Colors.white,
                fontWeight: FontWeight.bold,
              ),
            ),
          ),
        ),
      ],
    );
  }
}


------------------------------------------
FILE: lib\ui\admin\admin_house_list.dart
------------------------------------------
import 'package:flutter/material.dart';
import '../../models/house_model.dart';
import '../../services/firebase_service.dart';

class AdminHouseList extends StatelessWidget {
  final FirebaseService service;
  // Esta funci√≥n env√≠a la casa seleccionada a la AdminPage para editar
  final Function(HouseModel) onEdit;

  const AdminHouseList({
    super.key,
    required this.service,
    required this.onEdit,
  });

  @override
  Widget build(BuildContext context) {
    return Column(
      crossAxisAlignment: CrossAxisAlignment.start,
      children: [
        const Text(
          "Modelos en la Web",
          style: TextStyle(fontSize: 20, fontWeight: FontWeight.bold),
        ),
        const SizedBox(height: 20),
        Expanded(
          child: StreamBuilder(
            stream: service.getModels(),
            builder: (context, snapshot) {
              if (!snapshot.hasData) {
                return const Center(child: CircularProgressIndicator());
              }
              final docs = snapshot.data!.docs;

              if (docs.isEmpty) {
                return const Center(child: Text("No hay modelos publicados."));
              }

              return ListView.builder(
                itemCount: docs.length,
                itemBuilder: (context, index) {
                  final house = HouseModel.fromFirestore(
                    docs[index].data() as Map<String, dynamic>,
                    docs[index].id,
                  );
                  return Card(
                    margin: const EdgeInsets.only(bottom: 10),
                    elevation: 2,
                    child: ListTile(
                      // Eliminamos el onTap de toda la fila para evitar errores
                      leading: house.imageUrl.isNotEmpty
                          ? ClipRRect(
                              borderRadius: BorderRadius.circular(4),
                              child: Image.network(
                                house.imageUrl,
                                width: 50,
                                height: 50,
                                fit: BoxFit.cover,
                              ),
                            )
                          : const Icon(Icons.home, size: 40),
                      title: Text(
                        house.name,
                        style: const TextStyle(fontWeight: FontWeight.bold),
                      ),
                      subtitle: Text("Q${house.price}"),
                      // Agrupamos las acciones en el extremo derecho
                      trailing: Row(
                        mainAxisSize: MainAxisSize.min,
                        children: [
                          // BOT√ìN DE EDITAR
                          IconButton(
                            icon: const Icon(Icons.edit, color: Colors.blue),
                            tooltip: "Editar este modelo",
                            onPressed: () => onEdit(
                              house,
                            ), // <--- La magia ahora ocurre aqu√≠
                          ),
                          // BOT√ìN DE ELIMINAR
                          IconButton(
                            icon: const Icon(Icons.delete, color: Colors.red),
                            tooltip: "Eliminar definitivamente",
                            onPressed: () =>
                                _confirmDelete(context, docs[index].reference),
                          ),
                        ],
                      ),
                    ),
                  );
                },
              );
            },
          ),
        ),
      ],
    );
  }

  void _confirmDelete(BuildContext context, dynamic reference) {
    showDialog(
      context: context,
      builder: (context) => AlertDialog(
        title: const Text("¬øEliminar modelo?"),
        content: const Text(
          "Esta acci√≥n eliminar√° el registro de la base de datos de forma permanente.",
        ),
        actions: [
          TextButton(
            onPressed: () => Navigator.pop(context),
            child: const Text("Cancelar"),
          ),
          ElevatedButton(
            style: ElevatedButton.styleFrom(backgroundColor: Colors.red),
            onPressed: () {
              reference.delete();
              Navigator.pop(context);
            },
            child: const Text(
              "Eliminar",
              style: TextStyle(color: Colors.white),
            ),
          ),
        ],
      ),
    );
  }
}


------------------------------------------
FILE: lib\ui\admin\admin_project_list.dart
------------------------------------------
import 'package:flutter/material.dart';
import '../../widgets/models/project_model.dart';
import '../../services/firebase_service.dart';

class AdminProjectList extends StatelessWidget {
  final FirebaseService service;
  final Function(ProjectModel) onEdit;

  const AdminProjectList({
    super.key,
    required this.service,
    required this.onEdit,
  });

  @override
  Widget build(BuildContext context) {
    return StreamBuilder<List<ProjectModel>>(
      stream: service.getProjects(),
      builder: (context, snapshot) {
        if (snapshot.connectionState == ConnectionState.waiting) {
          return const Center(child: CircularProgressIndicator());
        }
        if (!snapshot.hasData || snapshot.data!.isEmpty) {
          return const Center(child: Text("No hay historias publicadas."));
        }

        return ListView.builder(
          itemCount: snapshot.data!.length,
          itemBuilder: (context, index) {
            final project = snapshot.data![index];
            return Card(
              margin: const EdgeInsets.only(bottom: 10),
              child: ListTile(
                leading: Image.network(
                  project.imageUrl,
                  width: 50,
                  height: 50,
                  fit: BoxFit.cover,
                ),
                title: Text(project.title),
                subtitle: Text(project.location),
                trailing: Row(
                  mainAxisSize: MainAxisSize.min,
                  children: [
                    IconButton(
                      icon: const Icon(Icons.edit, color: Colors.blue),
                      onPressed: () => onEdit(project),
                    ),
                    IconButton(
                      icon: const Icon(Icons.delete, color: Colors.red),
                      onPressed: () => service.deleteProject(project.id),
                    ),
                  ],
                ),
              ),
            );
          },
        );
      },
    );
  }
}


------------------------------------------
FILE: lib\ui\shared\app_logo.dart
------------------------------------------
import 'package:delta_dai_bim_web/core/app_colors.dart';
import 'package:flutter/material.dart';

class AppLogo extends StatelessWidget {
  final double height;
  const AppLogo({super.key, this.height = 50});

  @override
  Widget build(BuildContext context) {
    return Image.asset(
      'assets/images/logo_delta.png',
      height: height,
      fit: BoxFit.contain,
      errorBuilder: (context, error, stackTrace) => _buildFallbackText(),
    );
  }
}

class AppLogoNavbar extends StatelessWidget {
  final double? height; // Opcional para flexibilidad
  const AppLogoNavbar({super.key, this.height});

  @override
  Widget build(BuildContext context) {
    final double screenWidth = MediaQuery.of(context).size.width;

    // Si hay un height fijo (Admin), usa ese.
    // Si es nulo (Home), usa un c√°lculo "gradecito" (0.12 de la pantalla)
    double responsiveHeight = height ?? (screenWidth * 0.12).clamp(65.0, 110.0);

    return Image.asset(
      'assets/images/logo_delta_navbar.png',
      height: responsiveHeight,
      fit: BoxFit.contain,
      filterQuality: FilterQuality.high,
      errorBuilder: (context, error, stackTrace) => _buildFallbackText(),
    );
  }
}

Widget _buildFallbackText() {
  return RichText(
    text: const TextSpan(
      style: TextStyle(fontWeight: FontWeight.bold, fontSize: 20),
      children: [
        TextSpan(
          text: "DELTA ",
          style: TextStyle(color: AppColors.primaryRed),
        ),
        TextSpan(
          text: "DAI ",
          style: TextStyle(color: AppColors.grey),
        ),
        TextSpan(
          text: "BIM ",
          style: TextStyle(color: AppColors.blueAccent),
        ),
      ],
    ),
  );
}


------------------------------------------
FILE: lib\ui\shared\custom_footer.dart
------------------------------------------
import 'package:delta_dai_bim_web/services/external/whatsapp_service.dart';
import 'package:flutter/material.dart';
import '../../core/app_colors.dart';

class CustomFooter extends StatelessWidget {
  const CustomFooter({super.key});

  @override
  Widget build(BuildContext context) {
    final whatsAppService = WhatsAppService();

    return Container(
      width: double.infinity,
      color: AppColors.black,
      padding: const EdgeInsets.symmetric(vertical: 40),
      child: Column(
        children: [
          const Text(
            "DELTA DAI BIM - ¬© 2026",
            style: TextStyle(color: Colors.white),
          ),
          const SizedBox(height: 10),
          TextButton.icon(
            onPressed: () => whatsAppService.launchWhatsApp(isGeneral: true),
            icon: const Icon(Icons.chat, color: Colors.green),
            label: const Text(
              "Cont√°ctanos por WhatsApp",
              style: TextStyle(color: Colors.white),
            ),
          ),
        ],
      ),
    );
  }
}


------------------------------------------
FILE: lib\ui\shared\custom_navbar.dart
------------------------------------------
import 'dart:ui';
import 'package:flutter/material.dart';
import '../../core/app_colors.dart';
import 'app_logo.dart';
import '../../services/external/whatsapp_service.dart';

class CustomNavBar extends StatefulWidget implements PreferredSizeWidget {
  const CustomNavBar({super.key});

  @override
  State<CustomNavBar> createState() => _CustomNavBarState();

  @override
  Size get preferredSize => const Size.fromHeight(80); // Aumentado para el logo gradecito
}

class _CustomNavBarState extends State<CustomNavBar> {
  final WhatsAppService _whatsappService = WhatsAppService();
  int _logoClicks = 0;

  @override
  Widget build(BuildContext context) {
    final double screenWidth = MediaQuery.of(context).size.width;
    final bool isMobile = screenWidth < 900;

    return ClipRRect(
      child: BackdropFilter(
        filter: ImageFilter.blur(sigmaX: 15, sigmaY: 15),
        child: Container(
          decoration: BoxDecoration(
            color: Colors.white.withValues(alpha: 0.4),
            border: Border(
              bottom: BorderSide(
                color: Colors.white.withValues(alpha: 0.2),
                width: 1.0,
              ),
            ),
          ),
          child: AppBar(
            automaticallyImplyLeading: false,
            backgroundColor: Colors.transparent,
            elevation: 0,
            toolbarHeight: 80, // Ajustado al PreferredSize
            titleSpacing: isMobile ? 20 : 50,
            title: GestureDetector(
              onTap: () {
                setState(() => _logoClicks++);
                if (_logoClicks >= 5) {
                  _logoClicks = 0;
                  Navigator.pushNamed(context, '/login');
                }
              },
              // Quitamos el height fijo para que use el responsive de app_logo.dart
              child: const AppLogoNavbar(),
            ),
            actions: [
              if (!isMobile) ...[
                _navBtn("Inicio", () => Navigator.pushNamed(context, '/')),
                _navBtn(
                  "Proyectos",
                  () => Navigator.pushNamed(context, '/projects'),
                ),
                _navBtn(
                  "Modelos",
                  () => Navigator.pushNamed(context, '/models'),
                ),
                const SizedBox(width: 20),
                _actionBtn(
                  "COTIZAR",
                  () => _whatsappService.launchWhatsApp(isGeneral: true),
                ),
                const SizedBox(width: 50),
              ] else
                Padding(
                  padding: const EdgeInsets.only(right: 15),
                  child: IconButton(
                    icon: const Icon(
                      Icons.menu,
                      color: Colors.black87,
                      size: 32,
                    ),
                    onPressed: () => Scaffold.of(context).openDrawer(),
                  ),
                ),
            ],
          ),
        ),
      ),
    );
  }

  Widget _navBtn(String title, VoidCallback onTap) {
    return TextButton(
      onPressed: onTap,
      style: TextButton.styleFrom(foregroundColor: Colors.black87),
      child: Text(
        title,
        style: const TextStyle(fontWeight: FontWeight.bold, fontSize: 15),
      ),
    );
  }

  Widget _actionBtn(String title, VoidCallback onTap) {
    return Container(
      margin: const EdgeInsets.symmetric(vertical: 15),
      child: ElevatedButton(
        onPressed: onTap,
        style: ElevatedButton.styleFrom(
          backgroundColor: AppColors.primaryRed,
          padding: const EdgeInsets.symmetric(horizontal: 25),
          shape: const StadiumBorder(),
        ),
        child: Text(
          title,
          style: const TextStyle(
            color: Colors.white,
            fontWeight: FontWeight.bold,
          ),
        ),
      ),
    );
  }
}


------------------------------------------
FILE: lib\ui\shared\navbar_login_dialog.dart
------------------------------------------
import 'package:flutter/material.dart';
import '../../core/app_colors.dart';
import '../../services/firebase_service.dart';

class NavbarLoginDialog extends StatefulWidget {
  const NavbarLoginDialog({super.key});

  @override
  State<NavbarLoginDialog> createState() => _NavbarLoginDialogState();
}

class _NavbarLoginDialogState extends State<NavbarLoginDialog> {
  final _emailCtrl = TextEditingController();
  final _passCtrl = TextEditingController();
  final _service = FirebaseService();
  bool _isLoading = false;

  @override
  Widget build(BuildContext context) {
    return AlertDialog(
      title: const Text("Acceso Administrativo"),
      content: Column(
        mainAxisSize: MainAxisSize.min,
        children: [
          TextField(
            controller: _emailCtrl,
            decoration: const InputDecoration(labelText: "Correo"),
          ),
          TextField(
            controller: _passCtrl,
            obscureText: true,
            decoration: const InputDecoration(labelText: "Contrase√±a"),
          ),
          if (_isLoading) const LinearProgressIndicator(),
        ],
      ),
      actions: [
        TextButton(
          onPressed: () => Navigator.pop(context),
          child: const Text("CANCELAR"),
        ),
        ElevatedButton(
          style: ElevatedButton.styleFrom(
            backgroundColor: AppColors.primaryRed,
          ),
          onPressed: _isLoading ? null : _handleLogin,
          child: const Text("ENTRAR", style: TextStyle(color: Colors.white)),
        ),
      ],
    );
  }

  void _handleLogin() async {
    setState(() => _isLoading = true);
    var user = await _service.signIn(
      _emailCtrl.text.trim(),
      _passCtrl.text.trim(),
    );
    setState(() => _isLoading = false);

    if (user != null) {
      if (mounted) {
        Navigator.pop(context);
        Navigator.pushNamed(context, '/admin');
      }
    } else {
      if (mounted) {
        ScaffoldMessenger.of(context).showSnackBar(
          const SnackBar(content: Text("Credenciales incorrectas")),
        );
      }
    }
  }
}


------------------------------------------
FILE: lib\widgets\home\hero_section.dart
------------------------------------------
import 'dart:ui';
import 'package:flutter/material.dart';
import '../shared/app_logo.dart'; // Aseg√∫rate de que la ruta sea correcta

class HeroSection extends StatelessWidget {
  const HeroSection({super.key});

  @override
  Widget build(BuildContext context) {
    final double screenWidth = MediaQuery.of(context).size.width;
    final bool isMobile = screenWidth < 700;

    return SizedBox(
      height: isMobile ? 600 : 650,
      width: double.infinity,
      child: Stack(
        children: [
          // 1. FONDO (Se mantiene igual)
          Positioned.fill(
            child: Image.asset(
              'assets/images/fondo.jpeg',
              fit: BoxFit.cover,
              alignment: const Alignment(0, -0.75),
            ),
          ),

          // 2. DIFUMINADO GENERAL DEL FONDO
          Positioned.fill(
            child: ClipRect(
              child: BackdropFilter(
                filter: ImageFilter.blur(
                  sigmaX: 4.0,
                  sigmaY: 4.0,
                ), // Un poco menos de blur general
                child: Container(
                  decoration: BoxDecoration(
                    color: Colors.black.withValues(alpha: 0.3),
                    gradient: LinearGradient(
                      begin: Alignment.topCenter,
                      end: Alignment.bottomCenter,
                      colors: [
                        Colors.transparent,
                        Colors.black.withValues(alpha: 0.7),
                        Colors.black,
                      ],
                      stops: const [0.0, 0.7, 1.0],
                    ),
                  ),
                ),
              ),
            ),
          ),

          // 3. LOGO CENTRAL CON EFECTO CRISTAL (Aqu√≠ usamos la Clase)
          Positioned(
            top: isMobile ? 140 : 180,
            left: 0,
            right: 0,
            child: Center(
              child: ClipRRect(
                borderRadius: BorderRadius.circular(25),
                child: BackdropFilter(
                  filter: ImageFilter.blur(sigmaX: 10, sigmaY: 10),
                  child: Container(
                    padding: const EdgeInsets.symmetric(
                      horizontal: 30,
                      vertical: 20,
                    ),
                    decoration: BoxDecoration(
                      color: Colors.white.withValues(
                        alpha: 0.1,
                      ), // Capa de claridad
                      borderRadius: BorderRadius.circular(25),
                      border: Border.all(
                        color: Colors.white.withValues(alpha: 0.2),
                        width: 1.5,
                      ),
                    ),
                    // USAMOS LA CLASE OPTIMIZADA
                    child: AppLogo(height: isMobile ? 120 : 200),
                  ),
                ),
              ),
            ),
          ),

          // 4. TEXTOS (Se mantienen igual)
          Positioned(
            bottom: 60,
            left: 20,
            right: 20,
            child: Column(
              children: [
                Text(
                  "DISE√ëO Y CONSTRUCCI√ìN BIM",
                  textAlign: TextAlign.center,
                  style: TextStyle(
                    color: Colors.white,
                    fontSize: isMobile ? 26 : 52,
                    fontWeight: FontWeight.w900,
                    shadows: const [
                      Shadow(color: Colors.black, blurRadius: 15),
                    ],
                  ),
                ),
                const SizedBox(height: 12),
                Text(
                  "Innovaci√≥n y precisi√≥n en cada metro cuadrado",
                  textAlign: TextAlign.center,
                  style: TextStyle(
                    color: Colors.white.withValues(alpha: 0.9),
                    fontSize: isMobile ? 16 : 24,
                    fontWeight: FontWeight.w300,
                  ),
                ),
              ],
            ),
          ),
        ],
      ),
    );
  }
}


------------------------------------------
FILE: lib\widgets\home\info_section.dart
------------------------------------------
import 'package:flutter/material.dart';
import '../../core/app_colors.dart';

class InfoSection extends StatelessWidget {
  final String title;
  final String content;
  final Color backgroundColor;

  const InfoSection({
    super.key,
    required this.title,
    required this.content,
    this.backgroundColor = Colors.white,
  });

  @override
  Widget build(BuildContext context) {
    final size = MediaQuery.of(context).size;
    final bool isDesktop = size.width > 900;
    return Container(
      width: double.infinity,
      padding: EdgeInsets.symmetric(
        vertical: 80,
        horizontal: isDesktop ? size.width * 0.2 : 25,
      ),
      color: backgroundColor,
      child: Column(
        children: [
          Text(
            title,
            style: const TextStyle(
              fontSize: 28,
              fontWeight: FontWeight.bold,
              color: AppColors.primaryRed,
            ),
          ),
          const SizedBox(height: 20),
          ConstrainedBox(
            constraints: const BoxConstraints(maxWidth: 900),
            child: Text(
              content,
              textAlign: TextAlign.center,
              style: const TextStyle(
                fontSize: 20,
                height: 1.8,
                color: AppColors.greyDark,
                letterSpacing: 0.5,
              ),
            ),
          ),
        ],
      ),
    );
  }
}


------------------------------------------
FILE: lib\widgets\home\model_card.dart
------------------------------------------
import 'package:flutter/material.dart';
import '../../models/house_model.dart';
import '../../core/app_colors.dart';

class ModelCard extends StatelessWidget {
  final HouseModel house;

  const ModelCard({super.key, required this.house});

  @override
  Widget build(BuildContext context) {
    return Card(
      elevation: 4,
      shape: RoundedRectangleBorder(borderRadius: BorderRadius.circular(15)),
      child: Column(
        crossAxisAlignment: CrossAxisAlignment.start,
        children: [
          // Imagen del modelo
          ClipRRect(
            borderRadius: const BorderRadius.vertical(top: Radius.circular(15)),
            child: Image.network(
              house.imageUrl,
              height: 200,
              width: double.infinity,
              fit: BoxFit.cover,
              errorBuilder: (context, error, stackTrace) => Container(
                color: Colors.grey,
                child: const Icon(Icons.broken_image),
              ),
            ),
          ),
          Padding(
            padding: const EdgeInsets.all(12),
            child: Column(
              crossAxisAlignment: CrossAxisAlignment.start,
              children: [
                Text(
                  house.name,
                  style: const TextStyle(
                    fontWeight: FontWeight.bold,
                    fontSize: 18,
                  ),
                ),
                const SizedBox(height: 5),
                Text(
                  house.description,
                  maxLines: 2,
                  overflow: TextOverflow.ellipsis,
                  style: TextStyle(color: Colors.grey[600]),
                ),
                const SizedBox(height: 10),
                Text(
                  "Q${house.price.toStringAsFixed(2)}",
                  style: const TextStyle(
                    color: AppColors.primaryRed,
                    fontWeight: FontWeight.bold,
                    fontSize: 16,
                  ),
                ),
              ],
            ),
          ),
        ],
      ),
    );
  }
}


------------------------------------------
FILE: lib\widgets\models\house_card.dart
------------------------------------------
import 'package:delta_dai_bim_web/services/external/whatsapp_service.dart';
import 'package:flutter/material.dart';
import 'package:font_awesome_flutter/font_awesome_flutter.dart'; // Import agregado
import '../../models/house_model.dart';

class HouseCard extends StatelessWidget {
  final HouseModel house;
  final WhatsAppService service;
  final VoidCallback onMoreInfo;

  const HouseCard({
    super.key,
    required this.house,
    required this.service,
    required this.onMoreInfo,
  });

  @override
  Widget build(BuildContext context) {
    return Card(
      elevation: 5,
      shape: RoundedRectangleBorder(borderRadius: BorderRadius.circular(15)),
      child: Column(
        crossAxisAlignment: CrossAxisAlignment.start,
        children: [
          Expanded(
            child: ClipRRect(
              borderRadius: const BorderRadius.vertical(
                top: Radius.circular(15),
              ),
              child: Image.network(
                house.imageUrl,
                width: double.infinity,
                fit: BoxFit.cover,
              ),
            ),
          ),
          Padding(
            padding: const EdgeInsets.all(12),
            child: Column(
              crossAxisAlignment: CrossAxisAlignment.start,
              children: [
                Text(
                  house.name,
                  style: const TextStyle(
                    fontWeight: FontWeight.bold,
                    fontSize: 18,
                  ),
                ),
                Text(
                  "Q${house.price}",
                  style: const TextStyle(color: Colors.red),
                ),
                const SizedBox(height: 10),
                Row(
                  children: [
                    Expanded(
                      child: OutlinedButton(
                        onPressed: onMoreInfo,
                        child: const Text("Ver m√°s"),
                      ),
                    ),
                    const SizedBox(width: 8),
                    // CAMBIO A FAICON
                    IconButton(
                      icon: const FaIcon(
                        FontAwesomeIcons.whatsapp,
                        color: Colors.green,
                      ),
                      onPressed: () =>
                          service.launchWhatsApp(modelName: house.name),
                    ),
                  ],
                ),
              ],
            ),
          ),
        ],
      ),
    );
  }
}


------------------------------------------
FILE: lib\widgets\models\project_model.dart
------------------------------------------
class ProjectModel {
  final String id;
  final String title;
  final String description; // Aqu√≠ ir√° la "historia"
  final String imageUrl;
  final String location; // A√±adimos ubicaci√≥n para dar realismo
  final DateTime date; // Para ordenar por la m√°s reciente

  ProjectModel({
    required this.id,
    required this.title,
    required this.description,
    required this.imageUrl,
    required this.location,
    required this.date,
  });

  // Para convertir los datos de Firebase (JSON) a nuestro objeto Dart
  factory ProjectModel.fromMap(Map<String, dynamic> map, String id) {
    return ProjectModel(
      id: id,
      title: map['title'] ?? '',
      description: map['description'] ?? '',
      imageUrl: map['imageUrl'] ?? '',
      location: map['location'] ?? '',
      date: map['date'] != null ? DateTime.parse(map['date']) : DateTime.now(),
    );
  }

  // Para enviar los datos a Firebase
  Map<String, dynamic> toMap() {
    return {
      'title': title,
      'description': description,
      'imageUrl': imageUrl,
      'location': location,
      'date': date.toIso8601String(),
    };
  }
}
